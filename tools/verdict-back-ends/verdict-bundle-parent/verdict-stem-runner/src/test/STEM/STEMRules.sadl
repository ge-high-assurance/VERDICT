uri "http://sadl.org/STEM/STEMRules" alias stemr.

import "http://sadl.org/STEM/BaseModel".
//This version is using SADL 3 constructs and uses OWL_MEM reasoner.

// 1/4/2019: renamed rules so that they have CAPEC name in them.
//			commented out the transitive rules

// Later see if we can collapse 2 pairs of rules into 1 rule using hasValue
//		this is for pairs Vul-CAPEC125-1, Vul-CAPEC125-2 and Vul-CAPEC601-2, Vul-CAPEC601-3
// Do I need to add a pair for Vul-CAPEC-148-2 ?

// Note that currently not setting isHardware property to match with what Dan has.
// Also focus is on components inside Trusted Boundary; if not we would need to drop clause from rules

Rule Transitive1  
if inst is a cls and 
   cls is a type of Subsystem
then inst is a Subsystem. 

Rule Transitive2  
if inst is a cls and 
   cls is a type of Person
then inst is a Person.

Rule Transitive3
if inst is a Person
then inst is a Thing.

Rule Transitive4
if inst is a Subsystem
then inst is a Thing.

Rule Transitive5
if inst is a Subsystem
then inst is a System.

Rule Vul-CAPEC-125   
  if insideTrustedBoundary of a Subsystem is true and
     wifiFromOutsideTB of the Subsystem is true  
  then there exists (a CIAIssue with ciaIssue Availability,
		with affectedComponent the Subsystem,
		with capec "CAPEC-125",
		with capecDescription "Flooding"
		with likelihoodOfSuccess 1.0) and
		capecString of the Subsystem is "CAPEC-125:Flooding". 

Rule Vul-CAPEC-601-1 
  if insideTrustedBoundary of a Subsystem is true and
  	 broadcastFromOutsideTB of the Subsystem is true     
   then there exists (a CIAIssue with ciaIssue Availability, 
		with affectedComponent the Subsystem,
		with capec "CAPEC-601",
		with capecDescription "Jamming"
		with likelihoodOfSuccess 1.0) and
		capecString of the Subsystem is "CAPEC-601:Jamming".

Rule Vul-CAPEC-601-2 
  if insideTrustedBoundary of a Subsystem is true and
  	 wifiFromOutsideTB of the Subsystem is true     
   then there exists (a CIAIssue with ciaIssue Availability, 
		with affectedComponent the Subsystem,
		with capec "CAPEC-601",
		with capecDescription "Jamming"
		with likelihoodOfSuccess 1.0) and
		capecString of the Subsystem is "CAPEC-601:Jamming".
				
Rule Vul-CAPEC-547
  if insideTrustedBoundary of a Subsystem is true and
  	 isHardware of the Subsystem is true    
   then there exists (a CIAIssue with ciaIssue Availability,
		with affectedComponent the Subsystem,
		with capec "CAPEC-547",
		with capecDescription "Physical Destruction of Device or Component"
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-547:Physical Destruction of Device or Component".

Rule Vul-CAPEC-242-1   
  if insideTrustedBoundary of a Thing is false and  // could be a person
     the Thing is connectionSource of a Connection and
     a Subsystem is connectionDestination of the Connection and  
     insideTrustedBoundary of the Subsystem is true and
     connectionFlow of the Connection is Xdata			// altered 5/2/2019     
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with causingComponent the Thing,
		with capec "CAPEC-242",
		with capecDescription "Code Injection"
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-242:Code Injection".

Rule Vul-CAPEC-242-2   // added 5/2/2019. this works, ALTERNATIV: set it to false in the template if value does not exist - WHAT SYNTAX TO USE
  if a Thing is connectionSource of a Connection and // could be a person
     noValue(the Thing, insideTrustedBoundary) and
     a Subsystem is connectionDestination of the Connection and  
     insideTrustedBoundary of the Subsystem is true and
     connectionFlow of the Connection is Xdata			// altered 5/2/2019     
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with causingComponent the Thing,
		with capec "CAPEC-242",
		with capecDescription "Code Injection"
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-242:Code Injection".

Rule Vul-CAPEC-151  
  if insideTrustedBoundary of a Subsystem is true and 
     wifiFromOutsideTB of the Subsystem is true    
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with capec "CAPEC-151",
		with capecDescription "Identity Spoofing"
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-151:Identity Spoofing".

Rule Vul-CAPEC-148-1  
  if insideTrustedBoundary of a Subsystem is true and
  	 broadcastFromOutsideTB of the Subsystem is true  
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with capec "CAPEC-148",
		with capecDescription "Content Spoofing"
		with likelihoodOfSuccess 1.0) and
		capecString of the Subsystem is "CAPEC-148:Content Spoofing".

Rule Vul-CAPEC-148-2  
  if insideTrustedBoundary of a Subsystem is true and
  	 wifiFromOutsideTB of the Subsystem is true
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem
		with capec "CAPEC-148",
		with capecDescription "Content Spoofing"
		with likelihoodOfSuccess 1.0) and
		capecString of the Subsystem is "CAPEC-148:Content Spoofing".

Rule Vul-CAPEC-440  
  if insideTrustedBoundary of a Subsystem is true and
  	 isHardware of the Subsystem is true    
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with capec "CAPEC-440",
		with capecDescription "Hardware integrity Attack"
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-440:Hardware integrity Attack".
		
Rule Vul-CAPEC-441  
  if insideTrustedBoundary of a Subsystem is true and
  	 isHardware of the Subsystem is true  
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with capec "CAPEC-441",
		with capecDescription "Malicious Logic Insertion"		
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-441:Malicious Logic Insertion".

Rule Vul-CAPEC-28  
  if insideTrustedBoundary of a Subsystem is true and
     wifiFromOutsideTB of the Subsystem is true     
   then there exists (a CIAIssue with ciaIssue Integrity,
		with affectedComponent the Subsystem,
		with capec "CAPEC-28",
		with capecDescription "Fuzzing"
		with likelihoodOfSuccess 1.0)and
		capecString of the Subsystem is "CAPEC-28:Fuzzing".

////"transitive" rules should not flow to Person
//
//Rule AvailabilityTransitive1  
//  if ciaIssue of a CIAIssue is Availability and      
//     affectedComponent of the CIAIssue is a Subsystem and   
//     the Subsystem is connectionSource of a Connection and       
//     a second Subsystem is connectionDestination of the Connection  
//   then there exists (a second CIAIssue with ciaIssue Availability,
//		with affectedComponent the second Subsystem,
//		with causingComponent the first Subsystem,
//		with capecDescription "Availability failure of a component flows to affected component"). 
//
//Rule IntegrityTransitive1  	// Integrity does not flow on "Request" - is that reasonable as we expect a component to 
//							// to check the format / structure of a request?
//  if ciaIssue of a CIAIssue is Integrity and     
//     affectedComponent of the CIAIssue is a Subsystem and
//     the Subsystem is connectionSource of a Connection and     
//     a second Subsystem is connectionDestination of the Connection and  
//	 oneOf(connectionFlow of the Connection, Control, Xdata)     
//   then there exists (a second CIAIssue with ciaIssue Integrity,
//		with affectedComponent the second Subsystem,
//		with causingComponent the first Subsystem,			
//		with capecDescription "Integrity failure of a component flows to affected component via Control or Xdata" ). 
     		              
////////////////////// NIST defenses ///////////////////////////////////////// 

Rule Def-CAPEC-125  
  if ciaIssue of a CIAIssue is Availability and
     capec of the CIAIssue is "CAPEC-125" and
     affectedComponent of the CIAIssue is a Subsystem 
   then there exists (a Protection with ciaIssue Availability,
   	    with capecMitigated "CAPEC-125",
   	    with capecDescription "Flooding",
		with affectedComponent the Subsystem,
		with defense "SC-5",
		with protectionDescription "Denial of Service Protection")
	and there exists (a second Protection with ciaIssue Availability,
   	    with capecMitigated "CAPEC-125",
   	    with capecDescription "Flooding",
		with affectedComponent the Subsystem,
		with defense "SC-6",
		with protectionDescription "Resource Availability")
	and there exists (a third Protection with ciaIssue Availability,
   	    with capecMitigated "CAPEC-125",
   	    with capecDescription "Flooding",
		with affectedComponent the Subsystem,
		with defense "SC-7",
		with protectionDescription "Boundary Protection").   		

Rule Def-CAPEC-601  
  if ciaIssue of a CIAIssue is Availability and
     capec of the CIAIssue is "CAPEC-601" and
     affectedComponent of the CIAIssue is a Subsystem 
   then there exists (a Protection with ciaIssue Availability,
   	    with capecMitigated "CAPEC-601",
   	    with capecDescription "Jamming",
		with affectedComponent the Subsystem,
		with defense "SC-40",
		with protectionDescription "Wireless Link Protection"). 

Rule Def-CAPEC-28  
  if ciaIssue of a CIAIssue is Integrity and
     capec of the CIAIssue is "CAPEC-28" and
     affectedComponent of the CIAIssue is a Subsystem 
   then there exists (a Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-28", 
        with capecDescription "Fuzzing", 	
		with affectedComponent the Subsystem,
		with defense "SI-10",
		with protectionDescription "Information Input Validation")
	and there exists (a second Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-28",
   	    with capecDescription "Fuzzing",   	
		with affectedComponent the Subsystem,
		with defense "SI-17",
		with protectionDescription "Fail-Safe Procedures").   

Rule Def-CAPEC-151  
  if ciaIssue of a CIAIssue is Integrity and
     capec of the CIAIssue is "CAPEC-151" and
     affectedComponent of the CIAIssue is a Subsystem 
   then there exists (a Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",   
   	    with capecDescription "Identity Spoofing",	
		with affectedComponent the Subsystem,
		with defense "IA-2",
		with protectionDescription "Identification and Authentication (Organizational Users)")
	and there exists (a second Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",
   	    with capecDescription "Identity Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "IA-3",
		with protectionDescription "Device Identification and Authentication")
	and there exists (a third Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151", 
   	    with capecDescription "Identity Spoofing",  	
		with affectedComponent the Subsystem,
		with defense "IA-7",
		with protectionDescription "Cryptographic Module Authentication")
	and there exists (a fourth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",  
   	    with capecDescription "Identity Spoofing", 	
		with affectedComponent the Subsystem,
		with defense "SC-8",
		with protectionDescription "Transmission Confidentiality and Integrity")
	and there exists (a fifth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",
   	    with capecDescription "Identity Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-10",
		with protectionDescription "Network Disconnect")
	and there exists (a sixth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",
   	    with capecDescription "Identity Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-12",
		with protectionDescription "Cryptographic Key Establishment and Management")
	and there exists (a seventh Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",
   	    with capecDescription "Identity Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-13",
		with protectionDescription "Cryptographic Protection")
	and there exists (a eighth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-151",
   	    with capecDescription "Identity Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-23",
		with protectionDescription "Session Authenticity").  

Rule Def-CAPEC-148-1  
  if ciaIssue of a CIAIssue is Integrity and
     capec of the CIAIssue is "CAPEC-148" and
     affectedComponent of the CIAIssue is a Subsystem and
     wifiFromOutsideTB of the Subsystem is true 
   then there exists (a Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",   
   	    with capecDescription "Content Spoofing",	
		with affectedComponent the Subsystem,
		with defense "IA-2",
		with protectionDescription "Identification and Authentication (Organizational Users)")
	and there exists (a second Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",
   	    with capecDescription "Content Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "IA-3",
		with protectionDescription "Device Identification and Authentication")
	and there exists (a third Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148", 
   	    with capecDescription "Content Spoofing",  	
		with affectedComponent the Subsystem,
		with defense "IA-7",
		with protectionDescription "Cryptographic Module Authentication")
	and there exists (a fourth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",  
   	    with capecDescription "Content Spoofing", 	
		with affectedComponent the Subsystem,
		with defense "SC-8",
		with protectionDescription "Transmission Confidentiality and Integrity")
	and there exists (a fifth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",
   	    with capecDescription "Content Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-10",
		with protectionDescription "Network Disconnect")
	and there exists (a sixth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",
   	    with capecDescription "Content Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-12",
		with protectionDescription "Cryptographic Key Establishment and Management")
	and there exists (a seventh Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",
   	    with capecDescription "Content Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-13",
		with protectionDescription "Cryptographic Protection")
	and there exists (a eighth Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",
   	    with capecDescription "Content Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-23",
		with protectionDescription "Session Authenticity")
// 2/1/2019 commenting the next three as we are dropping them as defenses!		
//	and there exists (a ninth Protection with ciaIssue Integrity,
//   	    with capecMitigated "CAPEC-148", 
//   	    with capecDescription "Content Spoofing",  	
//		with affectedComponent the Subsystem,
//		with defense "SI-4",
//		with protectionDescription "Information System Monitoring")
//	and there exists (a tenth Protection with ciaIssue Integrity,
//   	    with capecMitigated "CAPEC-148", 
//   	    with capecDescription "Content Spoofing",  	
//		with affectedComponent the Subsystem,
//		with defense "SI-10",
//		with protectionDescription "Information Input Validation")
//	and there exists (a eleventh Protection with ciaIssue Integrity, // we go upto tenth; so this would be in a separate rule!!!
//   	    with capecMitigated "CAPEC-148",
//   	    with capecDescription "Content Spoofing",   	
//		with affectedComponent the Subsystem,
//		with defense "SI-17",
//		with protectionDescription "Fail-Safe Procedures")
.     	    

Rule Def-CAPEC-148-2  
  if ciaIssue of a CIAIssue is Integrity and
     capec of the CIAIssue is "CAPEC-148" and
     affectedComponent of the CIAIssue is a Subsystem and
     broadcastFromOutsideTB of the Subsystem is true 
   then there exists (a Protection with ciaIssue Integrity,
   	    with capecMitigated "CAPEC-148",
   	    with capecDescription "Content Spoofing",   	
		with affectedComponent the Subsystem,
		with defense "SC-29",
		with protectionDescription "Heterogeneity"). 				

////////////// Rules to relate NIST defenses with implementation properties /////////////

Rule Heterogeneity
  if defense of a Protection is "SC-29" and
     affectedComponent of the Protection is a Subsystem and
     val of heterogeneity of the Subsystem is true 
  then implProperty of the Protection is "heterogeneity" and
       dal of the Protection is dal of heterogeneity of the Subsystem and
       addressed of the Protection is true. 

Rule Encryption
  if oneOf(defense of a Protection, "IA-2", "IA-3", "IA-7", "SC-8", "SC-10", "SC-12", "SC-13", "SC-23") and
     affectedComponent of the Protection is a Subsystem and
     val of encryption of the Subsystem is true
  then implProperty of the Protection is "encryption" and
       dal of the Protection is dal of encryption of the Subsystem and
       addressed of the Protection is true.        

Rule AntiJamming
  if defense of a Protection is "SC-40" and
     affectedComponent of the Protection is a Subsystem and
     val of antiJamming of the Subsystem is true
  then implProperty of the Protection is "antiJamming" and
       dal of the Protection is dal of antiJamming of the Subsystem and
       addressed of the Protection is true.  
       
Rule AntiFlooding
  if oneOf(defense of a Protection, "SC-5", "SC-6", "SC-7") and
     affectedComponent of the Protection is a Subsystem and
     val of antiFlooding of the Subsystem is true
  then implProperty of the Protection is "antiFlooding" and
       dal of the Protection is dal of antiFlooding of the Subsystem and
       addressed of the Protection is true. 
       
Rule AntiFuzzing
  if oneOf(defense of a Protection, "SI-10", "SI-17") and
     affectedComponent of the Protection is a Subsystem and
     val of antiFuzzing of the Subsystem is true
  then implProperty of the Protection is "antiFuzzing" and
       dal of the Protection is dal of antiFuzzing of the Subsystem and
       addressed of the Protection is true.
                              